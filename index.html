<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cotizaciones Bancarias y Cripto</title>
<style>
/* === ESTILOS GLOBALES === */
:root {
  --base:#ccc;
  --gris:#111;
  --texto:#ddd;
  --borde:#ccc40;
  --error:#f44;
  --destacado-compra: rgba(40, 167, 69, 0.4); /* Green tint */
  --destacado-venta: rgba(0, 123, 255, 0.4); /* Blue tint */
}
body {
  background:#000;
  color:var(--texto);
  font-family:'Courier New', monospace;
  margin:0;
  padding:20px;
}
h1 {
  text-align:center;
  color:var(--base);
  font-size:2rem;
  margin-bottom:20px;
  text-shadow:0 0 8px rgba(204,204,204,0.6);
}
/* --- Navegación --- */
nav {
    max-width: 900px;
    margin: 0 auto 30px auto;
    text-align: center;
    padding: 10px 0;
    border-bottom: 1px solid #222;
    display: flex; /* MODIFICADO: Usa flex para mejor control */
    justify-content: center; /* MODIFICADO: Centra los enlaces */
    flex-wrap: nowrap; /* MODIFICADO: Evita el salto de línea */
}
nav a {
    color: var(--base);
    text-decoration: none;
    font-size: 1.1rem;
    padding: 8px 15px;
    margin: 0 5px;
    transition: background-color 0.3s;
    border: 1px solid transparent;
}
nav a.active {
    border-color: var(--base);
    background: rgba(204, 204, 204, 0.1);
}
nav a:hover:not(.active) {
    background: #111;
}

/* --- SECCIONES DE TABLAS NUEVAS (Bancos y USDT) --- */
.table-block-container {
    max-width: 900px;
    margin: 0 auto 40px auto;
}
.new-table-container {
    background: #050505;
    border: 1px solid #111;
    padding: 15px;
    border-radius: 0;
    margin-bottom: 20px;
    box-sizing: border-box;
}
.table-block-container h2 {
    color: var(--base);
    text-align: center;
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 1.5rem;
}

/* --- BANNERS DE RESUMEN (APLICADO A USD Y USDT) --- */
.summary-banner {
    background: #111;
    border-left: 5px solid #333;
    padding: 10px;
    box-shadow: none;
    display: flex;
    justify-content: space-around;
    gap: 15px;
    margin-bottom: 15px;
}
.best-buy {
    background-color: var(--destacado-compra);
    border-left: 5px solid #4f4;
}
.best-sell {
    background-color: var(--destacado-venta);
    border-left: 5px solid #007bff;
}
.best-deal {
    padding: 10px; border-radius: 4px; text-align: center; flex: 1;
}
.best-deal h3 {
    color: var(--base);
    font-size: 1em;
    margin: 0 0 5px 0;
}
.best-deal p {
    color: var(--texto);
    font-size: 1.2em; font-weight: bold; margin: 0;
}

.controls button {
    background-color: #333 !important;
    color: var(--base) !important;
    padding:6px 10px;
    border:1px solid #444;
    cursor:pointer;
}
#last-updated, .last-update {
    color: #777;
    font-size: 0.8em;
}

/* --- Tablas (General) --- */
.table-scroll-container, .table-container {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #333;
    border-radius: 0;
}
#quotation-table, .price-table {
    width: 100%;
    border-collapse: collapse;
}
#quotation-table th, .price-table th, 
#quotation-table td, .price-table td {
    padding: 12px 15px;
    text-align: center;
    border-bottom: 1px solid #222;
    background-color: #000;
}
#quotation-table th, .price-table th {
    background-color: #111 !important;
    color: var(--base) !important;
    cursor: pointer;
}
#quotation-table tbody tr:nth-child(even) {
    background-color: #050505;
}
/* Resaltado de mejores ofertas */
.highlight-best-buy, .price-table .best-buy-cell {
    background-color: var(--destacado-compra) !important;
    color: #fff !important;
}
.highlight-best-sell, .price-table .best-sell-cell {
    background-color: var(--destacado-venta) !important;
    color: #fff !important;
}

/* --- Estado de APIs --- */
#api-status {
  max-width: 900px;
  margin: 40px auto 0 auto;
  padding: 5px 20px;
  background: #050505;
  border: 1px solid #111;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 25px;
  box-sizing: border-box;
}
.api-indicator {
  padding: 0;
  border: none;
  box-shadow: none;
  display: flex;
  align-items: center;
  margin: 0 15px;
}
.api-indicator strong {
  display: inline;
  font-size: 0.8rem;
  margin-bottom: 0;
  color: #777;
  margin-right: 5px;
}
.status-light {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 5px;
  vertical-align: middle;
}
.status-light.funcional {
  background-color: #4f4;
  box-shadow: 0 0 8px #4f4;
}
.status-light.error {
  background-color: var(--error);
  box-shadow: 0 0 8px var(--error);
}
.status-text {
  font-weight: normal;
  font-size: 0.8rem;
  vertical-align: middle;
}
/* Media Query para móvil */
@media (max-width: 600px) {
    /* 1. Fix: Navegación */
    nav {
        justify-content: space-between;
        padding: 10px;
    }
    nav a {
        padding: 8px 5px;
        font-size: 0.9rem;
        margin: 0 2px;
    }
    /* 2. Fix: Botones de Actualización y Hora */
    .table-block-container .controls {
        flex-direction: column; /* Apila el botón y la hora */
        align-items: flex-start;
        gap: 5px;
    }
    .table-block-container .controls button {
        width: 100%; /* Botón al 100% del ancho para mejor toque */
        padding: 8px !important; 
        font-size: 1rem;
    }
    #last-updated-usd, #last-update-time-usdt {
        align-self: flex-start; /* Alinea el texto de hora a la izquierda */
        font-size: 0.8em;
    }
    /* Estilos API Status existente */
    #api-status {
        height: auto;
        flex-direction: column;
        padding: 8px 10px;
    }
    .api-indicator {
        margin: 3px 0;
        justify-content: center;
    }
}
</style>
</head>
<body>
<nav>
    <a href="index.html" class="active">Cotizaciones</a>
    <a href="calculadoras.html">Calculadoras</a>
    <a href="noticias.html">
    <a href="Graficos historicos.html">Gráficos</a>
    <a href="Hacienda.html">Agro</a>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cotizaciones USD</title>
  <style>
    /* === VARIABLES GLOBALES (Consistentes con index.html) === */
    :root {
      --base:#ccc;
      --gris:#111;
      --texto:#ddd;
      --borde:#ccc40;
      --error:#f44;
      --destacado-compra: rgba(40, 167, 69, 0.4);
      --destacado-venta: rgba(0, 123, 255, 0.4);
    }

    /* ------------------------------------------- */
    /* ESTILOS BASE Y RESPONSIVOS */
    /* ------------------------------------------- */
    body {
      background: #000; /* Fondo negro */
      color: var(--texto); /* Texto gris claro */
      font-family: 'Courier New', monospace; /* Fuente retro */
      margin: 0;
      padding: 0;
      font-size: 15px;
      text-align: center;
    }

    /* === HEADER y TÍTULO === */
    header {
        background-color: #111;
        color: var(--base);
        padding: 20px 0 10px 0;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    h1 {
      color: var(--base);
      font-size: 2rem;
      margin-bottom: 0;
      text-shadow:0 0 8px rgba(204,204,204,0.6);
      /* Margen inferior para separarlo de los controles */
      margin-bottom: 15px;
    }

    /* === NAVEGACIÓN === */
    nav {
        max-width: 1100px; /* Ancho para alinear con main */
        margin: 0 auto 30px auto;
        text-align: center;
        padding: 10px 0;
        border-bottom: 1px solid #222;
        display: flex;
        justify-content: center;
        flex-wrap: nowrap;
    }
    nav a {
        color: var(--base);
        text-decoration: none;
        font-size: 1.1rem;
        padding: 8px 15px;
        margin: 0 5px;
        transition: background-color 0.3s;
        border: 1px solid transparent;
    }
    nav a.active {
        border-color: var(--base);
        background: rgba(204, 204, 204, 0.1);
    }
    nav a:hover:not(.active) {
        background: #111;
    }

    /* === MAIN CONTAINER === */
    main {
        max-width: 1100px; /* Ancho suficiente para la tabla sin scroll horizontal en desktop */
        margin: 0 auto;
        padding: 0 10px; /* Padding horizontal para móviles */
        text-align: left; /* Alineamos el contenido dentro del main */
    }


    /* ------------------------------------------- */
    /* ESTILOS DE CONTROLES (Botones y Toggle) */
    /* ------------------------------------------- */
    .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
        margin-bottom: 15px;
    }

    /* Estilo del botón de Recarga */
    #refreshButton {
        padding: 8px 12px;
        cursor: pointer;
        background-color: #000;
        color: #007bff;
        border: 1px solid #007bff; /* Borde azul */
        border-radius: 0; /* Estilo plano */
        font-weight: bold;
        transition: background-color 0.2s, color 0.2s;
    }
    #refreshButton:hover:not(:disabled) {
        background-color: #007bff;
        color: white;
    }


    /* ------------------------------------------- */
    /* ESTILOS DEL TOGGLE DE MONEDA (Adaptado al tema oscuro) */
    /* ------------------------------------------- */
    .currency-toggle-container {
        display: flex;
        border: 1px solid #222; /* Borde sutil */
        border-radius: 0;
        overflow: hidden;
        flex-shrink: 0;
    }

    .currency-option {
        padding: 8px 12px;
        cursor: pointer;
        background-color: #050505; /* Fondo muy oscuro */
        color: var(--base);
        font-weight: bold;
        transition: background-color 0.2s, color 0.2s;
        flex-grow: 1;
        text-align: center;
        border-left: 1px solid #222;
    }
    .currency-option:first-child { border-left: none; }


    .currency-option.active {
        background-color: #2ecc71; /* Verde fuerte para activo */
        color: white;
        border-color: #2ecc71;
    }

    .currency-option:not(.active):hover {
        background-color: #111;
    }

    /* ------------------------------------------- */
    /* ESTILOS DE TABLA Y RESPONSIVIDAD */
    /* ------------------------------------------- */
    .table-container {
      /* Mantiene la capacidad de scroll en móviles, pero no lo fuerza en escritorio */
      overflow-x: auto;
      margin-top: 10px;
      margin-bottom: 20px;
      border: 1px solid #111;
    }

    #priceTable {
      min-width: 100%;
      width: max-content;
      border-collapse: collapse;
      font-size: 0.9em;
      background-color: #000;
    }

    /* Reglas comunes */
    #priceTable th, #priceTable td {
      border: 1px solid #111;
    }

    /* Encabezados (Permitimos el salto de línea) */
    #priceTable th {
      background-color: #111;
      text-align: left;
      font-weight: bold;
      padding: 10px 6px;
      color: var(--base);
      white-space: normal; /* Permite que el texto salte de línea */
    }

    /* Celdas de datos (NO permitimos el salto de línea para mantener alineación) */
    #priceTable td {
      padding: 8px 6px;
      text-align: right;
      white-space: nowrap; /* Evita que los datos se rompan */
    }

    /* Aumento de tamaño específico para los números (datos) */
    #priceTable td {
        font-size: 1em;
    }

    .categoria {
      text-align: left;
      font-weight: 500;
      min-width: 140px;
      padding-left: 8px;
    }

    #error {
        color: var(--error);
        margin-top: 5px;
        text-align: left;
    }

    /* ------------------------------------------- */
    /* ESTILOS DE VARICIÓN */
    /* ------------------------------------------- */
    .positive { color: #27ae60; }
    .negative { color: #e74c3c; }
    .neutral { color: #95a5a6; }
    .variacion::before { content: "▲ "; }
    .negative.variacion::before { content: "▼ "; }
    .neutral.variacion::before { content: "▬ "; }

    /* ------------------------------------------- */
    /* ESTILOS PARA WIDGETS DE TRADINGVIEW (SOLUCIÓN FINAL) */
    /* ------------------------------------------- */
    .market-widgets-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px; /* Espacio entre los widgets */
        margin-bottom: 25px;
        align-items: stretch;
    }

    /* Contenedor de cada widget para control de ancho */
    .tradingview-widget-container {
        /* SOLUCIÓN FINAL: Ajustado a -12.5px para forzar el espacio de píxeles fraccionarios y garantizar el borde. */
        flex: 1 1 calc(33.333% - 12.5px);
        min-width: 250px;
        border: 1px solid #111; /* Borde completo */
        padding: 0;
        background-color: #050505;
        box-sizing: border-box; /* Incluye padding y border en el cálculo del ancho */
    }

    /* ------------------------------------------- */
    /* OPTIMIZACIÓN MÓVIL (Max-width: 600px) */
    /* ------------------------------------------- */
    @media (max-width: 600px) {

        /* 1. Navegación: Permite que salte de línea */
        nav {
            flex-wrap: wrap;
            padding: 5px 0;
            margin-bottom: 10px;
        }
        nav a {
            flex: 1 1 auto;
            padding: 8px 5px;
            font-size: 0.9rem;
            margin: 5px 2px;
        }

        /* 2. Controles: Apilar y centrar */
        .controls {
            flex-direction: column;
            align-items: center; /* Centramos el botón */
            gap: 10px;
        }
        .currency-toggle-container { /* Mantenemos el toggle al 100% de ancho */
             width: 100%;
        }
        /* El botón #refreshButton toma su ancho natural (auto) y queda centrado */

        /* 3. Tabla: Forzamos ancho mínimo en móviles para que haya scroll horizontal */
        #priceTable {
            min-width: 550px; /* Garantiza el scroll en pantallas pequeñas */
            font-size: 0.85em; /* Reducimos la fuente para que quepan más datos */
        }

        /* 4. Widgets: Apilar verticalmente, ocupando el 100% del ancho */
        .tradingview-widget-container {
            flex: 1 1 100%;
            min-width: auto;
        }
    }
  </style>
</head>
<body>
    <header>
        </header>

    <nav>
        <a href="index.html">Cotizaciones</a>
        <a href="calculadoras.html">Calculadoras</a>
        <a href="noticias.html">Noticias</a>
        <a href="Graficos historicos.html">Gráficos</a>
        <a href="Hacienda.html" class="active">Agro</a>
    </nav>

    <main>
      <div class="market-widgets-container">
        <div class="tradingview-widget-container">
          <div class="tradingview-widget-container__widget"></div>

          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
          {
          "symbol": "MATBAROFEX:SOJCONT",
          "colorTheme": "dark",
          "isTransparent": false,
          "locale": "en",
          "width": "100%"
        }
          </script>
        </div>
        <div class="tradingview-widget-container">
          <div class="tradingview-widget-container__widget"></div>

          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
          {
          "symbol": "MATBAROFEX:TRICONT",
          "colorTheme": "dark",
          "isTransparent": false,
          "locale": "en",
          "width": "100%"
        }
          </script>
        </div>
        <div class="tradingview-widget-container">
          <div class="tradingview-widget-container__widget"></div>

          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
          {
          "symbol": "MATBAROFEX:MAICONT",
          "colorTheme": "dark",
          "isTransparent": false,
          "locale": "en",
          "width": "100%"
        }
          </script>
        </div>
        </div>
      <h1 style="text-align: center;">Listado de Precios Cañuelas</h1>

      <div class="controls">
        <div class="currency-toggle-container">
            <div id="toggleARS" class="currency-option active">ARS</div>
            <div id="toggleUSD" class="currency-option">USD</div>
        </div>
        <button id="refreshButton">🔄 Refrescar Ahora</button>
      </div>

      <div id="error"></div>

      <div class="table-container">
        <table id="priceTable">
          <thead>
            <tr>
              <th class="categoria">Categoría</th>
              <th id="headerCurrentPrice">Precio (Cierre)</th>
              <th>Cant. Operada (Hoy)</th>
              <th>Precio (Sem. Ant.)</th>
              <th>Cant. Operada (Sem. Ant.)</th>
              <th>Tendencia</th>
            </tr>
          </thead>
          <tbody>
            </tbody>
        </table>
      </div>
    </main>

    <footer>
        <p style="text-align:center; color:#999; padding: 15px 0; background-color: #111; margin-top: 30px;">
            Datos de Mercado de Cañuelas.
        </p>
    </footer>

  <script>
    // URL de la API con proxy (para evitar CORS)
    const API_URL = 'https://corsproxy.io/?https://www.decampoacampo.com/gh_funciones.php?function=getListadoPreciosGordo';
    const REFRESH_INTERVAL_MS = 15 * 60 * 1000; // 15 minutos en milisegundos

    let isUSD = false;
    let dataCache = null; // Cache para guardar los datos y solo re-renderizar al cambiar la moneda

    const toggleARS = document.getElementById('toggleARS');
    const toggleUSD = document.getElementById('toggleUSD');
    const refreshButton = document.getElementById('refreshButton');
    const tableBody = document.querySelector('#priceTable tbody');
    const headerCurrentPrice = document.getElementById('headerCurrentPrice');
    const errorDiv = document.getElementById('error');

    // Almacena el texto original del encabezado para poder modificarlo
    const originalHeaderCurrentPriceText = headerCurrentPrice.textContent;

    // Función de ayuda para formatear números como moneda
    const formatCurrency = (value, currency) => {
      if (value === null || value === undefined) return '-';

      // Reemplazar comas por puntos solo si es una cadena y es necesario
      const numValue = typeof value === 'string' ? parseFloat(value.replace(/,/g, '')) : value;

      const options = {
        style: 'decimal',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      };

      if (currency === 'ARS') {
        return numValue.toLocaleString('es-AR', options);
      } else if (currency === 'USD') {
        return numValue.toLocaleString('en-US', options);
      }
      return numValue.toFixed(2);
    };

    // Función para renderizar la tabla con los datos
    const renderTable = (data) => {
      tableBody.innerHTML = ''; // Limpiar la tabla

      dataCache = data; // Actualizar el caché de datos

      data.forEach(item => {
        // Seleccionar los campos basados en la moneda actual
        const currentPriceKey = isUSD ? 'precio_semana_1_usd' : 'precio_semana_1';
        const previousPriceKey = isUSD ? 'precio_semana_2_usd' : 'precio_semana_2';
        const variationKey = isUSD ? 'variacion_precio_semana_1_usd' : 'variacion_precio_semana_1';

        const currentPrice = item[currentPriceKey];
        const previousPrice = item[previousPriceKey];
        const variationValue = parseFloat(item[variationKey] || 0);

        // Clases de CSS para variación
        let variationClass = 'neutral';
        if (variationValue > 0) variationClass = 'positive';
        if (variationValue < 0) variationClass = 'negative';

        const row = tableBody.insertRow();

        row.insertCell().innerHTML = `<span class="categoria">${item.categoria}</span>`;

        row.insertCell().textContent = formatCurrency(currentPrice, isUSD ? 'USD' : 'ARS');

        row.insertCell().textContent = item.cantidad_semana_1 ? item.cantidad_semana_1.toLocaleString('es-AR') : '-';

        row.insertCell().textContent = formatCurrency(previousPrice, isUSD ? 'USD' : 'ARS');

        row.insertCell().textContent = item.cantidad_semana_2 ? item.cantidad_semana_2.toLocaleString('es-AR') : '-';

        const variationCell = row.insertCell();
        variationCell.className = `${variationClass} variacion`;

        // Formatear la variación
        const formattedVariation = (variationValue > 0 ? '+' : '') + formatCurrency(variationValue, isUSD ? 'USD' : 'ARS');

        variationCell.textContent = formattedVariation;
      });

      // Actualizar el encabezado del precio y mensaje.
      const currencySuffix = isUSD ? 'USD' : 'ARS';
      let headerText = 'Precio (Cierre)';

      // Detectamos si es el encabezado de "Cierre" para agregar la moneda
      if (headerCurrentPrice.textContent.includes('(Cierre)')) {
          headerText = `Precio (Cierre) (${currencySuffix})`;
      } else {
          // Esto es un fallback en caso de que el texto cambie
          headerText = `${originalHeaderCurrentPriceText} (${currencySuffix})`;
      }

      headerCurrentPrice.textContent = headerText;
      errorDiv.textContent = `Datos actualizados. Moneda: ${isUSD ? 'USD' : 'ARS'}.`;
    };

    // Función para actualizar el estado del toggle
    const updateToggleState = () => {
        if (isUSD) {
            toggleUSD.classList.add('active');
            toggleARS.classList.remove('active');
        } else {
            toggleARS.classList.add('active');
            toggleUSD.classList.remove('active');
        }
    }


    // Función principal para obtener datos de la API
    const fetchData = async () => {
      refreshButton.disabled = true; // Desactivar durante la carga
      refreshButton.textContent = 'Cargando...';
      errorDiv.textContent = 'Cargando datos...';

      try {
        const response = await fetch(API_URL);

        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }

        const data = await response.json();

        if (data.data && Array.isArray(data.data)) {
          // Si la carga fue exitosa, renderizar con los datos nuevos
          renderTable(data.data);
        } else {
          throw new Error('Estructura de datos inesperada de la API.');
        }

      } catch (error) {
        console.error('Error al obtener los datos:', error);
        errorDiv.textContent = `❌ Error al cargar los datos. (${error.message})`;
        tableBody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No se pudo cargar la información.</td></tr>';
      } finally {
        refreshButton.disabled = false;
        refreshButton.textContent = '🔄 Recargar';
      }
    };

    // --- MANEJO DE EVENTOS Y REFRESH ---

    // Alternar Moneda y renderizar
    const handleCurrencyToggle = (currency) => {
        const wasUSD = isUSD;
        isUSD = currency === 'USD';

        // Solo re-renderizar si la moneda cambió O si ya tenemos datos en caché
        if (wasUSD !== isUSD || dataCache) {
            updateToggleState();
            if (dataCache) {
                renderTable(dataCache); // Re-renderizar con datos en caché
            } else {
                fetchData(); // Si no hay datos, cargar desde API
            }
        }
    };

    toggleARS.addEventListener('click', () => handleCurrencyToggle('ARS'));
    toggleUSD.addEventListener('click', () => handleCurrencyToggle('USD'));

    // Refresco manual
    refreshButton.addEventListener('click', fetchData);

    // Refresco automático cada 15 minutos
    setInterval(fetchData, REFRESH_INTERVAL_MS);

    // Iniciar la carga de datos y estado inicial
    updateToggleState();
    fetchData();
  </script>
</body>
</html>
</a>
</nav>
<h1>Cotizaciones Bancarias y Cripto</h1>

<div class="table-block-container new-table-container">
    <h2>📊 Dólar (USD/ARS) Bancos</h2>

    <div id="summary-banner-usd" class="summary-banner" >
        <div class="best-deal best-buy" id="best-buy-deal-usd">
            <h3>💰 Mejor Compra (Ask más bajo)</h3>
            <p id="best-buy-info-usd">Cargando...</p>
        </div>
        <div class="best-deal best-sell" id="best-sell-deal-usd">
            <h3>💸 Mejor Venta (Bid más alto)</h3>
            <p id="best-sell-info-usd">Cargando...</p>
        </div>
    </div>

    <div class="controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <button id="refresh-button-usd">🔄 Actualizar Ahora</button>
        <span id="last-updated-usd">Última actualización: --:--:--</span>
    </div>

    <div class="table-container">
        <table id="quotation-table">
            <thead>
                <tr>
                    <th style="text-align: left;">Entidad</th>
                    <th id="sort-ask" class="sortable">Compra (Ask)</th>
                    <th id="sort-bid" class="sortable">Venta (Bid)</th>
                </tr>
            </thead>
            <tbody id="quotation-body-usd">
                <tr><td colspan="3">Cargando cotizaciones...</td></tr>
            </tbody>
        </table>
    </div>

    <p class="footer" style="text-align: center; margin-top: 10px; font-size: 0.8em; color: #666;">Datos provistos por CriptoYa - Actualización automática cada 5 minutos.</p>
</div>

<div class="table-block-container new-table-container">
    <h2>💸 Cotización de Compra/Venta USDT/ARS</h2>

    <div id="summary-banner-usdt" class="summary-banner" >
        <div class="best-deal best-buy" id="best-buy-deal-usdt">
            <h3>💰 Compras más Barata (Ask)</h3>
            <p id="best-buy-info-usdt">Cargando...</p>
        </div>
        <div class="best-deal best-sell" id="best-sell-deal-usdt">
            <h3>🚀 Vendes más Cara (Bid)</h3>
            <p id="best-sell-info-usdt">Cargando...</p>
        </div>
    </div>

    <div class="controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <button class="update-button" id="manual-update-button-usdt">🔄 Actualizar Precios</button>
        <span class="last-update" id="last-update-time-usdt">Última actualización: Cargando...</span>
    </div>

    <div class="table-scroll-container">
        <table class="price-table">
            <thead>
                <tr>
                    <th style="text-align: left;">Exchange</th>
                    <th class="sortable" data-sort-by="ask">Compra (Ask)</th>
                    <th class="sortable" data-sort-by="bid">Venta (Bid)</th>
                </tr>
            </thead>
            <tbody id="price-table-body-usdt">
                <tr><td colspan="3">Cargando cotizaciones...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="api-status">
  <div class="api-indicator">
    <strong>DolarAPI.com:</strong>
    <span id="dolarapi-status">
      <span class="status-light"></span>
      <span class="status-text">Cargando...</span>
    </span>
  </div>
  <div class="api-indicator">
    <strong>ArgentinaDatos.com:</strong>
    <span id="argentinadatos-status">
      <span class="status-light"></span>
      <span class="status-text">Cargando...</span>
    </span>
  </div>
  <div class="api-indicator">
    <strong>CriptoYa.com:</strong>
    <span id="criptoya-status">
      <span class="status-light"></span>
      <span class="status-text">Cargando...</span>
    </span>
  </div>
</div>

<script>
/* ========================================================== */
/* === SCRIPT 1: TABLA BANCOS USD/ARS (Sin cambios) === */
/* ========================================================== */
(function() {
    const API_URL = 'https://criptoya.com/api/bancostodos';
    const TABLE_BODY = document.getElementById('quotation-body-usd');
    const LAST_UPDATED_SPAN = document.getElementById('last-updated-usd');
    const REFRESH_BUTTON = document.getElementById('refresh-button-usd');
    const BEST_BUY_INFO = document.getElementById('best-buy-info-usd');
    const BEST_SELL_INFO = document.getElementById('best-sell-info-usd');

    let currentSort = { column: 'ask', direction: 1 };

    const formatCurrency = (value) => {
        return new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS', minimumFractionDigits: 2, }).format(value);
    };

    const processData = (rawData) => {
        const cleanedData = [];
        for (const [entityName, prices] of Object.entries(rawData)) {
            const ask = prices.ask;
            const bid = prices.bid;
            const isValid = (value) => value !== null && value !== 0 && typeof value === 'number' && !isNaN(value);
            if (isValid(ask) && isValid(bid)) { cleanedData.push({ entity: entityName, ask: ask, bid: bid, }); }
        }
        return cleanedData;
    };

    const applySort = (data, column, direction) => {
        return [...data].sort((a, b) => {
            if (a[column] < b[column]) return -1 * direction;
            if (a[column] > b[column]) return 1 * direction;
            return 0;
        });
    };

    const initialSort = (data) => {
        if (data.length === 0) return [];
        const bestAskValue = Math.min(...data.map(item => item.ask));
        const bestBidValue = Math.max(...data.map(item => item.bid));
        const highlights = [];
        const rest = [];
        const highlightEntities = new Set();
        data.forEach(item => {
            const isBestAsk = item.ask === bestAskValue;
            const isBestBid = item.bid === bestBidValue;
            if (isBestAsk || isBestBid) {
                if (!highlightEntities.has(item.entity)) {
                    highlights.push(item);
                    highlightEntities.add(item.entity);
                }
            } else {
                rest.push(item);
            }
        });
        rest.sort((a, b) => b.bid - a.bid); 
        return [...highlights, ...rest];
    };

    const updateSummaryBanner = (data) => {
        const buyDeal = document.getElementById('best-buy-deal-usd');
        const sellDeal = document.getElementById('best-sell-deal-usd');
        
        if (data.length === 0) {
            BEST_BUY_INFO.textContent = 'No hay datos válidos.';
            BEST_SELL_INFO.textContent = 'No hay datos válidos.';
            buyDeal.className = 'best-deal summary-banner';
            sellDeal.className = 'best-deal summary-banner';
            return;
        }

        const bestAsk = data.reduce((min, curr) => (!min || curr.ask < min.ask) ? curr : min, null);
        const bestBid = data.reduce((max, curr) => (!max || curr.bid > max.bid) ? curr : max, null);

        if (bestAsk) {
            BEST_BUY_INFO.innerHTML = `${bestAsk.entity}: <br>${formatCurrency(bestAsk.ask)}`;
            buyDeal.className = 'best-deal best-buy';
        }
        if (bestBid) {
            BEST_SELL_INFO.innerHTML = `${bestBid.entity}: <br>${formatCurrency(bestBid.bid)}`;
            sellDeal.className = 'best-deal best-sell';
        }
    };

    const renderTable = (data) => {
        TABLE_BODY.innerHTML = '';
        if (data.length === 0) {
            TABLE_BODY.innerHTML = '<tr><td colspan="3" style="color: var(--error); text-align:center;">No hay cotizaciones válidas para mostrar.</td></tr>';
            return;
        }

        const bestAskValue = Math.min(...data.map(item => item.ask));
        const bestBidValue = Math.max(...data.map(item => item.bid));

        data.forEach(item => {
            const row = TABLE_BODY.insertRow();
            const isBestAsk = item.ask === bestAskValue;
            const isBestBid = item.bid === bestBidValue;
            
            const entityCell = row.insertCell();
            entityCell.textContent = item.entity;
            entityCell.style.textAlign = 'left';

            const askCell = row.insertCell();
            askCell.textContent = formatCurrency(item.ask);
            if (isBestAsk) { askCell.classList.add('highlight-best-buy'); }

            const bidCell = row.insertCell();
            bidCell.textContent = formatCurrency(item.bid);
            if (isBestBid) { bidCell.classList.add('highlight-best-sell'); }
        });

        LAST_UPDATED_SPAN.textContent = `Última actualización: ${new Date().toLocaleTimeString('es-AR')}`;
    };

    const fetchDataAndRender = async (isInitialLoad = false) => {
        REFRESH_BUTTON.disabled = true;
        REFRESH_BUTTON.textContent = 'Cargando...';

        try {
            const response = await fetch(API_URL);
            if (!response.ok) { throw new Error(`Error en la API: ${response.statusText}`); }
            const rawData = await response.json();
            const processed = processData(rawData);
            updateSummaryBanner(processed);

            let dataToShow;
            if (isInitialLoad) {
                dataToShow = initialSort(processed);
                currentSort = { column: 'ask', direction: 1 };
            } else {
                dataToShow = applySort(processed, currentSort.column, currentSort.direction);
            }
            renderTable(dataToShow);
        } catch (error) {
            console.error('Error al obtener o procesar datos USD:', error);
            TABLE_BODY.innerHTML = `<tr><td colspan="3" style="color: var(--error); text-align:center;">Error al cargar los datos.</td></tr>`;
            BEST_BUY_INFO.textContent = 'Error de carga.';
            BEST_SELL_INFO.textContent = 'Error de carga.';
            document.getElementById('best-buy-deal-usd').className = 'best-deal summary-banner';
            document.getElementById('best-sell-deal-usd').className = 'best-deal summary-banner';
        } finally {
            REFRESH_BUTTON.disabled = false;
            REFRESH_BUTTON.textContent = '🔄 Actualizar Ahora';
        }
    };

    const handleSortClick = async (column) => {
        let newDirection;
        if (currentSort.column === column) { newDirection = currentSort.direction * -1; } 
        else { newDirection = (column === 'ask') ? 1 : -1; }
        currentSort = { column: column, direction: newDirection };
        
        // Re-fetch para garantizar datos frescos antes de ordenar
        const response = await fetch(API_URL);
        const data = processData(await response.json()); 

        renderTable(applySort(data, currentSort.column, currentSort.direction));
    };

    document.addEventListener('DOMContentLoaded', () => {
        fetchDataAndRender(true);
        REFRESH_BUTTON.addEventListener('click', () => fetchDataAndRender(false));
        document.getElementById('sort-ask').addEventListener('click', () => handleSortClick('ask'));
        document.getElementById('sort-bid').addEventListener('click', () => handleSortClick('bid'));
        const FIVE_MINUTES = 5 * 60 * 1000;
        setInterval(() => fetchDataAndRender(false), FIVE_MINUTES);
    });
})();

/* ========================================================== */
/* === SCRIPT 2: TABLA USDT/ARS (Sin cambios) === */
/* ========================================================== */
(function() {
    const API_URL = 'https://criptoya.com/api/usdt/ars/0.1';
    const tableBody = document.getElementById('price-table-body-usdt');
    const sortableHeaders = document.querySelectorAll('.price-table .sortable');
    const updateButton = document.getElementById('manual-update-button-usdt');
    const lastUpdateTimeSpan = document.getElementById('last-update-time-usdt');
    const BEST_BUY_INFO = document.getElementById('best-buy-info-usdt');
    const BEST_SELL_INFO = document.getElementById('best-sell-info-usdt');
    const AUTO_UPDATE_INTERVAL = 300000; 

    let allExchangeData = [];
    let bestPrices = {};
    let currentSort = { column: null, direction: null };
    
    // UTILS
    function capitalize(s) {
        if (typeof s !== 'string' || s.length === 0) return '';
        return s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();
    }
    function formatPrice(price) {
        return price.toLocaleString('es-AR', { style: 'currency', currency: 'ARS', minimumFractionDigits: 2, maximumFractionDigits: 2, });
    }

    function updateLastUpdateTime(date) {
        const timeString = date.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        lastUpdateTimeSpan.textContent = `Última actualización: ${timeString}`;
    }

    function processData(data) {
        const processed = [];
        for (const [exchange, values] of Object.entries(data)) {
            // Filtrar y limpiar datos
            if (values.ask && values.ask > 0 && values.bid && values.bid > 0) {
                processed.push({
                    exchange: capitalize(exchange),
                    ask: parseFloat(values.ask),
                    bid: parseFloat(values.bid)
                });
            }
        }
        return processed;
    }

    function findBestPrices(data) {
        let bestBuy = data.reduce((min, item) => (item.ask < min.price ? { exchange: item.exchange, price: item.ask } : min), { exchange: '', price: Infinity });
        let bestSell = data.reduce((max, item) => (item.bid > max.price ? { exchange: item.exchange, price: item.bid } : max), { exchange: '', price: -Infinity });
        return { bestBuy, bestSell };
    }

    function updateSummaryBanner() {
        const buyDeal = document.getElementById('best-buy-deal-usdt');
        const sellDeal = document.getElementById('best-sell-deal-usdt');

        if (!bestPrices.bestBuy || bestPrices.bestBuy.price === Infinity) {
            BEST_BUY_INFO.textContent = 'No hay datos válidos.';
            BEST_SELL_INFO.textContent = 'No hay datos válidos.';
            buyDeal.className = 'best-deal summary-banner';
            sellDeal.className = 'best-deal summary-banner';
            return;
        }

        const buyPrice = formatPrice(bestPrices.bestBuy.price);
        const sellPrice = formatPrice(bestPrices.bestSell.price);

        BEST_BUY_INFO.innerHTML = `${bestPrices.bestBuy.exchange}: <br>${buyPrice}`;
        buyDeal.className = 'best-deal best-buy';

        BEST_SELL_INFO.innerHTML = `${bestPrices.bestSell.exchange}: <br>${sellPrice}`;
        sellDeal.className = 'best-deal best-sell';
    }

    function renderTable(data) {
        tableBody.innerHTML = '';
        if (data.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="3" style="color: var(--error); text-align:center;">No hay cotizaciones válidas para mostrar.</td></tr>';
            return;
        }

        data.forEach(item => {
            const row = tableBody.insertRow();
            
            const exchangeCell = row.insertCell();
            exchangeCell.textContent = item.exchange;
            exchangeCell.style.textAlign = 'left';

            const askCell = row.insertCell();
            askCell.textContent = formatPrice(item.ask);
            if (item.exchange === bestPrices.bestBuy.exchange) { askCell.classList.add('best-buy-cell'); }

            const bidCell = row.insertCell();
            bidCell.textContent = formatPrice(item.bid);
            if (item.exchange === bestPrices.bestSell.exchange) { bidCell.classList.add('best-sell-cell'); }
        });
    }

    // SORTING LOGIC
    function initialDataPresentation() {
        const bestBuyExchange = bestPrices.bestBuy.exchange;
        const bestSellExchange = bestPrices.bestSell.exchange;
        const bestBuyItem = allExchangeData.find(item => item.exchange === bestBuyExchange);
        const bestSellItem = allExchangeData.find(item => item.exchange === bestSellExchange);
        const restOfData = allExchangeData.filter(item =>
            item.exchange !== bestBuyExchange && item.exchange !== bestSellExchange
        );
        restOfData.sort((a, b) => b.bid - a.bid);
        let finalPresentationData = [];
        if (bestBuyItem) { finalPresentationData.push(bestBuyItem); }
        if (bestSellItem && bestBuyExchange !== bestSellExchange) { finalPresentationData.push(bestSellItem); }
        finalPresentationData = finalPresentationData.concat(restOfData);
        renderTable(finalPresentationData);
    }

    function applySorting(column, direction) {
        const sortedData = [...allExchangeData].sort((a, b) => {
            let comparison = 0;
            if (a[column] > b[column]) { comparison = 1; } 
            else if (a[column] < b[column]) { comparison = -1; }
            return direction === 'desc' ? comparison * -1 : comparison;
        });

        currentSort = { column, direction };
        renderTable(sortedData);
    }

    function handleHeaderClick() {
        const column = this.dataset.sortBy;
        let direction = 'asc';

        if (currentSort.column === column) {
            direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
            direction = column === 'ask' ? 'asc' : 'desc';
        }
        applySorting(column, direction);
    }

    // MAIN FETCH
    async function fetchPrices() {
        updateButton.disabled = true;
        updateButton.textContent = '🔄 Cargando...';
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
            const data = await response.json();
            allExchangeData = processData(data);
            if (allExchangeData.length === 0) { throw new Error("No se recibieron datos de cotización válidos."); }
            bestPrices = findBestPrices(allExchangeData);
            updateSummaryBanner();

            if (currentSort.column === null) { initialDataPresentation(); } 
            else { applySorting(currentSort.column, currentSort.direction); }

            updateLastUpdateTime(new Date());

        } catch (error) {
            console.error("Error al obtener o procesar la cotización USDT:", error);
            BEST_BUY_INFO.textContent = 'Error de carga.';
            BEST_SELL_INFO.textContent = 'Error de carga.';
            document.getElementById('best-buy-deal-usdt').className = 'best-deal summary-banner';
            document.getElementById('best-sell-deal-usdt').className = 'best-deal summary-banner';
            tableBody.innerHTML = `<tr><td colspan="3" style="color:var(--error); text-align:center;">⚠️ Error al cargar los datos.</td></tr>`;
        } finally {
            updateButton.disabled = false;
            updateButton.textContent = '🔄 Actualizar Precios';
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchPrices();
        updateButton.addEventListener('click', fetchPrices);
        sortableHeaders.forEach(header => { header.addEventListener('click', handleHeaderClick); });
        setInterval(fetchPrices, AUTO_UPDATE_INTERVAL);
    });
})();

/* ========================================================== */
/* === SCRIPT 3: MONITOREO DE ESTADO DE APIS (Sin cambios) === */
/* ========================================================== */
async function checkApiStatus(url, elementId) {
  const statusElement = document.getElementById(elementId);
  const light = statusElement.querySelector('.status-light');
  const text = statusElement.querySelector('.status-text');

  light.className = 'status-light';
  text.textContent = 'Cargando...';
  text.style.color = '#ddd';

  try {
    const response = await fetch(url);
    const data = await response.json();

    // Lógica simplificada que el usuario indicó que funciona para DolarAPI y ArgentinaDatos.
    // Se utiliza para todas las APIs para mantener el código unificado.
    const isUp = (data.status === "ok" || data.status === "available" || response.ok);

    if (isUp) {
      light.className = 'status-light funcional';
      text.textContent = 'Funcional';
      text.style.color = '#4f4';
    } else {
      light.className = 'status-light error';
      text.textContent = 'Error';
      text.style.color = 'var(--error)';
    }
  } catch (e) {
    light.className = 'status-light error';
    text.textContent = 'Error';
    text.style.color = 'var(--error)';
    console.error(`Error al verificar estado de API ${elementId}:`, e);
  }
}

function loadApiStatus() {
  checkApiStatus("https://dolarapi.com/v1/estado", "dolarapi-status");
  checkApiStatus("https://api.argentinadatos.com/v1/estado", "argentinadatos-status");
  checkApiStatus("https://criptoya.com/api/dolar", "criptoya-status"); 
}

loadApiStatus();
setInterval(loadApiStatus, 3600000); 
</script>
</body>
</html>
